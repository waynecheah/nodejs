<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>
    Smart Home Mobile
  </title>
  <meta name="description" content="here is the description of the mobile app">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
  <link href="http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700" rel='stylesheet' />

  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
  <link rel="stylesheet" href="css/bootstrap.css" />
  <link rel="stylesheet" href="css/style.css" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
</head>
<body>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
<![endif]-->

<!-- Add your site or application content here -->

    <!-- Sign In -->
    <div data-role="page" id="sign-in">
      <div id="signin" data-theme="b" data-role="header" data-position="fixed" class="signin">
        <h3>
          Sign In
        </h3>
      </div>
      <div data-role="content">
        <div data-role="fieldcontain">
          <label for="username">
            Username
          </label>
          <input name="username" id="username" placeholder="username" value="" type="text" data-mini="true">
        </div>
        <div data-role="fieldcontain">
          <label for="password">
            Password
          </label>
          <input name="password" id="password" placeholder="password" value="" type="password" data-mini="true">
        </div>
        <div data-role="fieldcontain">
          <label for="save-password">
            Save Password
          </label>
          <select name="toggleswitch1" id="save-password" data-theme="" data-role="slider" data-mini="true">
            <option value="off">
              No
            </option>
            <option value="on">
              Yes
            </option>
          </select>
        </div>
      </div>
      <div data-theme="d" data-role="footer" data-position="fixed">
        <div class="ui-grid-a">
          <div class="ui-block-a">&nbsp;</div>
          <div class="ui-block-b" style="text-align:right; padding-right:1em;">
            <a id="login" data-role="button" data-inline="true" data-transition="flip" href="#home" data-icon="check" data-iconpos="left">
              Login
            </a>
          </div>
        </div>
      </div>
    </div>


    <!-- Home -->
    <div data-role="page" id="home">
      <div data-theme="c" data-role="header" data-position="fixed" class="header">
        <h3 class="companyName">
          Home Security and Automation
        </h3>
      </div>
      <div data-role="content">
        <ul data-role="listview" data-divider-theme="c" data-inset="false">
          <li data-theme="c">
            <a href="#page-security" data-transition="slide" style="padding-bottom:7px;">
              <img src="img/lock.png" alt="..." class="ui-li-thumb" />
              <div class="ui-grid-b">
                <div class="ui-block-a" style="padding-top:9px;"><h3>Security</h3></div>
                <div class="ui-block-b" style="padding-top:9px; text-align:right;">
                  <p>Status</p>
                  <p>Troubles</p>
                  <p>Connection</p>
                </div>
                <div class="ui-block-c" style="padding-top:9px;">
                  <p>: <strong class="status text-default">Disconnected</strong></p>
                  <p>: <strong class="troubles text-default">N/A</strong></p>
                  <p>: <strong class="connection text-default">Disconnected</strong></p>
                </div>
              </div>
            </a>
          </li>
          <li data-theme="c">
            <a href="#page-cameras" data-transition="slide">
              <img src="img/camera.png" alt="..." class="ui-li-thumb" />
              <div class="ui-grid-a">
                <div class="ui-block-a" style="padding-top:9px;"><h3>Cameras</h3></div>
                <div class="ui-block-b" style="line-height:45px; padding-top:13px; text-align:right;"><p>Available</p></div>
              </div>
              <span class="ui-li-count">3</span>
            </a>
          </li>
          <li data-theme="c">
            <a href="#page-system-status" data-transition="slide">
              <img src="img/thermostats.png" alt="..." class="ui-li-thumb" />
              <div style="padding:9px 0;"><h3>System Status</h3></div>
            </a>
          </li>
          <li data-theme="c">
            <a href="#page-lights" data-transition="slide">
              <img src="img/light.png" alt="..." class="ui-li-thumb" />
              <div class="ui-grid-a">
                <div class="ui-block-a" style="padding-top:9px;"><h3>Lights</h3></div>
                <div class="ui-block-b" style="line-height:45px; padding-top:13px; text-align:right;"><p>Available</p></div>
              </div>
              <span class="ui-li-count">2</span>
            </a>
          </li>
          <li data-theme="c">
            <a href="#page-history" data-transition="slide">
              <img src="img/history.png" alt="..." class="ui-li-thumb" />
              <div style="padding:9px 0;"><h3>History</h3></div>
            </a>
          </li>
        </ul>

        <div class="gainPermissions" style="display:none; margin-top:35px;">
          <button data-role="button" data-transition="none" href="#">
            <span class="txt">Set notification permissions for this App</span>
          </button>
        </div>

      </div>
      <div data-theme="a" data-role="footer" data-position="fixed" class="footer">
        <div data-role="navbar" data-iconpos="top">
          <ul>
            <li><a href="#home" data-direction="reverse" data-transition="flow" data-theme="" data-icon="home" class="ui-btn-active ui-state-persist">Home</a></li>
            <li><a href="#page-security" data-transition="flow" data-theme="" data-icon="alert">Security</a></li>
            <li><a href="#page-cameras" data-transition="flow" data-theme="" data-icon="star">Cameras</a></li>
            <li><a href="#page-system-status" data-transition="flow" data-theme="" data-icon="info">System Status</a></li>
          </ul>
        </div>
      </div>
    </div>


    <!-- Security -->
    <div data-role="page" id="page-security" data-render="0">
      <div data-theme="b" data-role="header" data-position="fixed">
        <a data-role="button" data-inline="true" data-direction="reverse" data-rel="back" data-transition="slidefade"
           data-theme="c" href="#home" data-icon="arrow-l" data-iconpos="left" class="ui-btn-left back">
          Back
        </a>
        <h3 class="header">
          Security
        </h3>
      </div>
      <div data-role="content">
        <div class="armBtnWrap" style="display:none;">
          <a data-role="button" data-transition="slideup" class="armBtn">
            <span class="glyphicon"></span> <span class="armTxt">Disarmed - Press to Arm</span>
          </a>
        </div>
        <h2 class="grey normal">Home Security Zones</h2>
        <ul data-role="listview" data-divider-theme="d" data-inset="false"></ul>
      </div>
      <div data-theme="a" data-role="footer" data-position="fixed" class="footer">
        <div data-role="navbar" data-iconpos="top">
          <ul>
            <li><a href="#home" data-direction="reverse" data-transition="flow" data-theme="" data-icon="home">Home</a></li>
            <li><a href="#page-security" data-transition="flow" data-theme="" data-icon="alert" class="ui-btn-active ui-state-persist">Security</a></li>
            <li><a href="#page-cameras" data-transition="flow" data-theme="" data-icon="star">Cameras</a></li>
            <li><a href="#page-termostats" data-transition="flow" data-theme="" data-icon="info">System Status</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Alert Opened Zones -->
    <div data-role="page" id="dialog-alert-opened-zones">
      <div data-role="header">
        <h2>Opened Zones Detected</h2>
      </div>
      <div data-role="content">
        <h3>Unable to proceed arm when opened zones detected. You may bypass this zones to continue arm.</h3>
        <a href="#page-security" data-role="button" data-rel="back" data-theme="b" class="">Ok, i get it</a>
      </div>
    </div>

    <!-- How to Arm -->
    <div data-role="page" id="page-how-to-arm">
      <div data-theme="e" data-role="header" data-position="fixed">
        <a href="#home" data-role="button" data-inline="true" data-direction="reverse" data-rel="back"
           data-theme="c" data-icon="delete" data-iconpos="left" class="ui-btn-left back cancelArm">
          Cancel
        </a>
        <h3 class="header">
          Confirm Arm
        </h3>
      </div>
      <div data-role="content">
        <div class="armTypeWrap">
          <h3 class="text-muted">Choose How To Arm</h3>
          <div class="center">
            <div data-role="controlgroup" data-mini="true" data-type="horizontal">
              <a href="#" data-role="button" data-alarm="h" class="armType">Arm Stay</a>
              <a href="#" data-role="button" data-alarm="a" class="armType ui-btn-active">Arm Away</a>
              <a href="#" data-role="button" data-alarm="h" class="armType">Arm Night</a>
            </div>
          </div>
        </div>
        <h4 class="text-muted armCodeTxt">Enter Keypad Code To Arm</h4>
        <div class="ui-grid-c" style="padding-left:5px;">
          <div class="ui-block-a">
            <div data-role="fieldcontain">
              <input name="code1" id="code1" data-no="1" type="tel" data-mini="true" class="passcode">
            </div>
          </div>
          <div class="ui-block-b">
            <div data-role="fieldcontain">
              <input name="code2" id="code2" data-no="2" type="tel" data-mini="true" class="passcode">
            </div>
          </div>
          <div class="ui-block-c">
            <div data-role="fieldcontain">
              <input name="code3" id="code3" data-no="3" type="tel" data-mini="true" class="passcode">
            </div>
          </div>
          <div class="ui-block-d">
            <div data-role="fieldcontain">
              <input name="code4" id="code4" data-no="4" type="tel" data-mini="true" class="passcode">
            </div>
          </div>
        </div>
        <div class="countdown" style="display:none; margin-top:30px;">
          <div class="progress">
            <div class="progress-bar progress-bar-success" style="width:100%;"
             role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
              <span class="sr-only">Arm in 10 Seconds</span>
            </div>
          </div>
          <button data-role="button" data-icon="delete" data-iconpos="left" data-theme="e" class="cancelArm" >Cancel Arm</button>
        </div>
      </div>
    </div>


    <!-- System Status -->
    <div data-role="page" id="page-system-status">
      <div data-theme="b" data-role="header" data-position="fixed">
        <a data-role="button" data-inline="true" data-direction="reverse" data-rel="back" data-transition="slidefade"
           data-theme="c" href="#home" data-icon="arrow-l" data-iconpos="left" class="ui-btn-left back">
          Back
        </a>
        <h3 class="header">
          System Status
        </h3>
      </div>
      <div data-role="content">
        <ul data-role="listview" data-divider-theme="d" data-inset="true">
          <li data-theme="d">Power
            <span class="ui-li-aside normal power">N/A</span>
          </li>
          <li data-theme="d">Battery
            <span class="ui-li-aside normal battery">N/A</span>
          </li>
          <li data-theme="d">PSTN
            <span class="ui-li-aside normal pstn">N/A</span>
          </li>
          <li data-theme="d">Comm
            <span class="ui-li-aside normal comm">N/A</span>
          </li>
          <li data-theme="d">Keypad
            <span class="ui-li-aside normal keypad">N/A</span>
          </li>
        </ul>
      </div>
      <div data-theme="a" data-role="footer" data-position="fixed" class="footer">
        <div data-role="navbar" data-iconpos="top" class="visible-xs">
          <ul>
            <li><a href="#home" data-direction="reverse" data-transition="flow" data-theme="" data-icon="home">Home</a></li>
            <li><a href="#page-security" data-transition="flow" data-theme="" data-icon="alert">Security</a></li>
            <li><a href="#page-cameras" data-transition="flow" data-theme="" data-icon="star">Cameras</a></li>
            <li><a href="#page-system-status" data-transition="flow" data-theme="" data-icon="info" class="ui-btn-active ui-state-persist">System Status</a></li>
          </ul>
        </div>
      </div>
    </div>


    <!-- Cameras -->
    <div data-role="page" id="page-cameras">
      <div data-theme="b" data-role="header" data-position="fixed" class="header">
        <a data-role="button" data-inline="true" data-direction="reverse" data-rel="back" data-transition="slidefade"
           data-theme="c" href="#home" data-icon="arrow-l" data-iconpos="left" class="ui-btn-left back">
          Back
        </a>
        <h3 class="header">
          Cameras
        </h3>
      </div>
      <div data-role="content">
        <ul data-role="listview" data-divider-theme="c" data-inset="false">
          <li data-theme="c">
            <a href="#page-cam1" data-transition="slide">
              <img src="http://cheah.homeip.net:86/snapshot.cgi?user=cheah&pwd=jumpknee123"
               width="120" height="80" alt="..." class="ui-li-thumb freesize" />
              <h3 style="padding-left:40px;">Kitchen Camera</h3>
              <p style="padding-left:40px;">linksys WVC80N</p>
            </a>
          </li>
          <li data-theme="c">
            <a href="#page-cam2" data-transition="slide">
              <img src="http://cheah.homeip.net:85/snapshot.cgi?user=cheah&pwd=jumpknee123"
               width="120" height="80" alt="..." class="ui-li-thumb freesize" />
              <h3 style="padding-left:40px;">Dining Room</h3>
              <p style="padding-left:40px;">linksys WVC80N</p>
            </a>
          </li>
          <li data-theme="c">
            <a href="#page-cam3" data-transition="slide">
              <img src="http://cheah.homeip.net:81/snapshot.cgi?loginuse=cheah&loginpas=jumpkne"
               width="120" height="80" alt="..." class="ui-li-thumb freesize" />
              <h3 style="padding-left:40px;">Upstairs Camera</h3>
              <p style="padding-left:40px;">linksys WVC80N</p>
            </a>
          </li>
          <li>
            <a href="#page-cam4" data-transition="slide">
              <canvas width="120" height="80" class="ipcam"
               data-url="http://cheah.homeip.net:81/snapshot.cgi?loginuse=cheah&loginpas=jumpkne"></canvas>
              <h3 style="padding-left:40px;">Upstairs Camera</h3>
              <p style="padding-left:40px;">linksys WVC80N</p>
            </a>
          </li>
          <li>
            <a href="#page-cam5" data-transition="slide">
              <canvas width="120" height="80" class="ipcam"
               data-url="http://cheah.homeip.net:85/snapshot.cgi?user=cheah&pwd=jumpknee123"></canvas>
              <h3 style="padding-left:40px;">Dining Camera</h3>
              <p style="padding-left:40px;">linksys WVC80N</p>
            </a>
          </li>
        </ul>
      </div>
      <div data-theme="a" data-role="footer" data-position="fixed" class="footer">
        <div data-role="navbar" data-iconpos="top">
          <ul>
            <li>
              <a href="#home" data-direction="reverse" data-transition="flow" data-theme="" data-icon="home">
                Home
              </a>
            </li>
            <li>
              <a href="#page-security" data-direction="reverse" data-transition="flow" data-theme="" data-icon="alert">
                Security
              </a>
            </li>
            <li>
              <a href="#page-cameras" data-transition="flow" data-theme="" data-icon="star" class="ui-btn-active ui-state-persist">
                Cameras
              </a>
            </li>
            <li>
              <a href="#page-system-status" data-transition="flow" data-theme="" data-icon="info">System Status</a>
            </li>
          </ul>
        </div>
      </div>
    </div>


    <!-- Lights -->
    <div data-role="page" id="page-lights">
      <div data-theme="b" data-role="header" data-position="fixed" class="header">
        <a data-role="button" data-inline="true" data-direction="reverse" data-rel="back" data-transition="slidefade"
           data-theme="c" href="#home" data-icon="arrow-l" data-iconpos="left" class="ui-btn-left back">
          Back
        </a>
        <h3 class="header">
          Lights
        </h3>
      </div>
      <div data-role="content">
        <ul data-role="listview" data-divider-theme="c" data-inset="false">
          <li data-theme="c">
            <div class="row">
              <div class="bs col-xs-2 col-sm-1">
                <img data-src="holder.js/55x100/industrial" alt="..." class="ui-li-thumb freesize2" />
              </div>
              <div class="bs col-xs-10 col-sm-11">
                <div class="row">
                  <div class="bs col-xs-8">
                    <h3 class="listTitle" style="line-height:41px;">Dimmable Light</h3>
                  </div>
                  <div class="bs col-xs-4">
                    <div data-role="fieldcontain" style="text-align:right;">
                      <select name="lightSwitch1" id="lightSwitch1" data-role="slider">
                        <option value="off">
                          Off
                        </option>
                        <option value="on" selected>
                          On
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="bs col-xs-12">
                    <div data-role="fieldcontain" class="slider">
                      <input id="light1" type="range" name="light1" value="50" min="0" max="100" data-highlight="true">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>
          <li data-theme="c">
            <div class="row">
              <div class="bs col-xs-2 col-sm-1">
                <img data-src="holder.js/55x100/industrial" alt="..." class="ui-li-thumb freesize2" />
              </div>
              <div class="bs col-xs-10 col-sm-11">
                <div class="row">
                  <div class="bs col-xs-8">
                    <h3 class="listTitle" style="line-height:91px;">On/Off Light</h3>
                  </div>
                  <div class="bs col-xs-4">
                    <div data-role="fieldcontain" class="right" style="padding-top:20px;">
                      <select name="lightSwitch2" id="lightSwitch2" data-role="slider">
                        <option value="off">
                          Off
                        </option>
                        <option value="on">
                          On
                        </option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
      <div data-theme="a" data-role="footer" data-position="fixed" class="footer">
        <div data-role="navbar" data-iconpos="top">
          <ul>
            <li>
              <a href="#home" data-direction="reverse" data-transition="flow" data-theme="" data-icon="home">
                Home
              </a>
            </li>
            <li>
              <a href="#page-security" data-direction="reverse" data-transition="flow" data-theme="" data-icon="alert">
                Security
              </a>
            </li>
            <li>
              <a href="#page-cameras" data-transition="flow" data-theme="" data-icon="star">
                Cameras
              </a>
            </li>
            <li>
              <a href="#page-system-status" data-transition="flow" data-theme="" data-icon="info">
                System Status
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>


    <!-- History -->
    <div data-role="page" id="page-history">
      <div data-theme="b" data-role="header" data-position="fixed">
        <a data-role="button" data-inline="true" data-direction="reverse" data-rel="back" data-transition="slidefade"
           data-theme="c" href="#home" data-icon="arrow-l" data-iconpos="left" class="ui-btn-left back">
          Back
        </a>
        <h3 class="header">
          History
        </h3>
      </div>
      <div data-role="content">
        <div class="center">
          <div data-role="controlgroup" data-type="horizontal">
            <a href="#" data-role="button" class="ui-btn-active">All</a>
            <a href="#" data-role="button">Alarm</a>
            <a href="#" data-role="button">Arm</a>
            <a href="#" data-role="button">Zone</a>
          </div>
        </div>
        <h2 class="grey center normal">January 12, 2013</h2>
        <ul data-role="listview" data-divider-theme="d" data-inset="false">
          <li data-theme="c">
            <a href="#page1" data-transition="slide">
              <img data-src="holder.js/80x80" alt="..." class="ui-li-thumb" />
              <div class="ui-grid-a">
                <div class="ui-block-a">
                  <h3 class="listTitle">Event</h3>
                  <p>Camera 1 (1 image)</p>
                </div>
                <div class="ui-block-b" style="line-height:45px; padding-top:13px; text-align:right;"><p>6:06 PM</p></div>
              </div>
            </a>
          </li>
          <li data-theme="d">
            <a href="#page1" data-transition="slide">
              <img data-src="holder.js/80x80" alt="..." class="ui-li-thumb" />
              <h3>Kitchen door</h3>
              <p>communication restored</p>
            </a>
          </li>
          <li data-theme="c">
            <a href="#page1" data-transition="slide">
              <img data-src="holder.js/80x80" alt="..." class="ui-li-thumb" />
              <h3>Kitchen door</h3>
              <p>communication failure</p>
            </a>
          </li>
          <li data-theme="d">
            <a href="#page1" data-transition="slide">
              <img data-src="holder.js/80x80" alt="..." class="ui-li-thumb" />
              <h3>Zone door</h3>
              <p>communication failure</p>
            </a>
          </li>
        </ul>
      </div>
      <div data-theme="a" data-role="footer" data-position="fixed" class="footer">
        <div data-role="navbar" data-iconpos="top" class="visible-xs">
          <ul>
            <li><a href="#home" data-direction="reverse" data-transition="flow" data-theme="" data-icon="home">Home</a></li>
            <li><a href="#page-security" data-transition="flow" data-theme="" data-icon="alert">Security</a></li>
            <li><a href="#page-cameras" data-transition="flow" data-theme="" data-icon="star">Cameras</a></li>
            <li><a href="#page-system-status" data-transition="flow" data-theme="" data-icon="info">System Status</a></li>
          </ul>
        </div>
      </div>
    </div>


    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.10.1.min.js"><\/script>')</script>
    <script src="//code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/holder/2.0/holder.min.js"></script>
    <script>
      var _client    = '';
      var _body      = '';
      var _countDown = false;
      var _cancelArm = false;
      var _data      = {
          status: {
              alarm_status: 'r'
          }
      };

      function loggedSuccess () {
        var deviceCls = '';
        if (typeof _data.root == 'undefined') {
          _client   = _data.client;
          _body     = _data.body;
          deviceCls = 'clientDevice';
        } else {
          deviceCls = 'addDevice';
        }

        $('div.loginWrap').slideUp(function(){
          $('div.commandWrap,div.'+deviceCls).fadeIn(function(){
            $('#command').focus();
          });
        });
      } // loggedSuccess

      function resetMessage (second) {
          if (typeof second == 'undefined') {
              second = 3000;
          }
          setTimeout(function(){
              $('div.alert').fadeOut(function(){
                  $(this).attr('class', 'alert').html('');
              });
          }, second);
      } // resetMessage

      function updateTroubles (id) {
          var troubles = 0;
          var total    = 0;

          $.each(_data.status, function(k, v){
              if (k != 'alarm_status') {
                  total++;
                  if (v == 0) {
                      troubles++
                  }
              }
          });

          if (troubles) {
              $('.troubles').removeClass('text-success text-default').addClass('text-danger').html('Problem '+troubles+'/'+total);
          } else {
              $('.troubles').removeClass('text-danger text-default').addClass('text-success').html('OK '+troubles+'/'+total);
          }

          if (typeof id != 'undefined') {
              var sts, css;

              if (_data.status[id] == 1) {
                  sts = 'OK';
                  css = 'text-success';
              } else {
                  sts = 'Failure';
                  css = 'text-danger';
              }

              $('#page-system-status').find('span.'+id).html(sts).removeClass('text-success text-danger').addClass(css);
              notification('System Status', 'System status of '+id+' is now changed to '+sts);
          }
      } // updateTroubles

      function updateAlarmStatus (alert) {
          var rdr = $('#page-security').attr('data-render');
          var thm = 'b';
          var sts = '';

          if (_data.status.alarm_status == 'a') {
              thm = 'e';
              sts = 'Armed Away';
              $('#page-security a.armBtn span.glyphicon').attr('class', 'glyphicon glyphicon-lock');
              $('#page-security a.armBtn span.armTxt').html('Armed Away - Press to Disamed');
          } else if (_data.status.alarm_status == 'h') {
              thm = 'e';
              sts = 'Armed Home';
              $('#page-security a.armBtn span.glyphicon').attr('class', 'glyphicon glyphicon-lock');
              $('#page-security a.armBtn span.armTxt').html('Armed Home - Press to Disamed');
          } else if (_data.status.alarm_status == 'r') {
              sts = 'Disarmed';
              $('#page-security a.armBtn span.glyphicon').attr('class', 'glyphicon glyphicon-warning-sign');
              $('#page-security a.armBtn span.armTxt').html('Disarmed - Press to Arm');
          } else if (_data.status.alarm_status == 'p') {
              sts = 'Panic';
              $('#page-security a.armBtn span.glyphicon').attr('class', 'glyphicon glyphicon-warning-sign');
              $('#page-security a.armBtn span.armTxt').html('Panic - Press to Arm');
          }

          $('#page-security a.armBtn').attr('data-status', _data.status.alarm_status);

          if (rdr == '1') {
              //$('#page-security a.armBtn').button('refresh');
              $('#page-security a.armBtn').buttonMarkup({ theme:thm });
          } else {
            console.log('not render '+rdr);
              $('#page-security a.armBtn').attr('data-theme', thm);
          }

          if (alert) {
              notification('Alarm Status', 'Alarm status is now changed to '+sts);
          }
      } // updateAlarmStatus

      function updateZones () {
          var rendered = $('#page-security').attr('data-render');
          var listview = '';
          var mapping  = {
              o: 'Opened',
              c: 'Closed',
              b: 'Bypassed',
              d: 'Disabled'
          };

          $.each(_data.zones, function(k, v){
              var s1 = '';
              var s2 = '';

              if (v == 'o') {
                  s1 = ' selected';
                  s2 = '';
              } else if (v == 'b') {
                  s1 = '';
                  s2 = ' selected';
              }

              listview += '<li data-theme="c" class="'+k+'"><img data-src="holder.js/80x80" alt="..." class="ui-li-thumb" />' +
                          '<h3>'+k.replace('z','Zone ')+'</h3><p>'+mapping[v]+'</p><span class="ui-li-aside">' +
                          '<div data-role="fieldcontain" data-status="'+v+'" class="bypass" style="display:none;">' +
                          '<select name="'+k+'" id="bp'+k+'" data-theme="d" data-role="slider">' +
                          '<option value="o"'+s1+'>Open</option><option value="b"'+s2+'>Bypass</option></select>' +
                          '</div></span></li>';
          });

          $('#page-security ul[data-role=listview]').html(listview);
          $('#page-security ul[data-role=listview] li select[data-role=slider]').on('slidestop', function(e, ui){
              var obj = {};
              obj[$(e.target).attr('name')] = $(e.target).val();
              socket.emit('app update', 'zones', obj);
          });
          Holder.run();

          if (rendered == '1') {
              $('#page-security ul[data-role=listview]').listview('refresh');
          }
      } // updateZones

      function updateZone (id, value) {
          var mapping = {
              o: 'Opened',
              c: 'Closed',
              b: 'Bypassed',
              d: 'Disabled'
          };

          if ($('#page-security ul[data-role=listview] li').length > 0) { // only if listview is rendered
              if (value == 'o' || value == 'b') {
                  $('#bp'+id).val(value);
                  $('#page-security ul[data-role=listview] li select[data-role=slider]').slider('refresh');
              } else {
                  $('#page-security ul[data-role=listview] li.'+id+' div.bypass').hide();
              }
              $('#page-security ul[data-role=listview] li.'+id+' div.bypass').attr('data-status', value);
              $('#page-security ul[data-role=listview] li.'+id+' p.ui-li-desc').html(mapping[value]);
          }

          notification('Zone Status', id.replace('z', 'Zone ')+' status is now changed to '+mapping[value]);
      } // updateZone

      function updateSystemStatus () {
          var sts, css;

          $.each(_data.status, function(k, v){
              if (k != 'alarm_status') {
                  if (v == 1) {
                      sts = 'OK';
                      css = 'text-success';
                  } else {
                      sts = 'Failure';
                      css = 'text-danger';
                  }
                  $('#page-system-status').find('span.'+k).html(sts).removeClass('text-success text-danger').addClass(css);
              }
          });
      } // updateSystemStatus

      function notification (title, content, timeclose) {
          if (typeof window.webkitNotifications == 'undefined') {
              return;
          }
          if (window.webkitNotifications.checkPermission() == 0) { // 0 is PERMISSION_ALLOWED
              var ntf  = window.webkitNotifications.createNotification('img/warning.png', title, content);
              var time = (typeof timeclose == 'undefined') ? 8000 : timeclose;

              ntf.ondisplay = function() {
                  window.setTimeout(function() {
                    console.log('close '+title);
                      ntf.cancel();
                  }, time);
                console.log('display '+title);
              };
              ntf.onclose = function() {
                  console.log('Notification closing');
              };
              ntf.show();
          } else {
              window.webkitNotifications.requestPermission();
          }
      } // notification

      function permissionCheck () {
          if (window.webkitNotifications.checkPermission() == 0) {
              $('div.gainPermissions').fadeOut('normal', function(){
                  $(this).remove();
              });
          } else {
              setTimeout(permissionCheck, 1000);
          }
      } // permissionCheck

      function armCountdown (sec) {
          var cls = null;

          if (!_countDown) {
              _countDown = true;
              _cancelArm = false;
          }

          if (sec >= 0) {
              sec--;

              if (sec <= 3) {
                  cls = 'progress-bar-danger';
              } else if (sec <= 7) {
                  cls = 'progress-bar-warning';
              } else {
                  cls = 'progress-bar-success';
              }

              setTimeout(function(){
                  if (_cancelArm) {
                      _cancelArm = false;
                      return;
                  }
                  $('#page-how-to-arm div.progress-bar').css('width', (sec*10)+'%')
                   .removeClass('progress-bar-success progress-bar-warning progress-bar-danger').addClass(cls);
                  $('div.ui-loader h1').html('Arm in '+sec+' seconds');
                  armCountdown(sec);
              }, 1000);
          } else {
              var armType = 'r';
              _countDown  = false;
              _cancelArm  = false;

              if ($('#page-how-to-arm div.armTypeWrap:visible').length) {
                  armType = $('#page-how-to-arm a.ui-btn-active').attr('data-alarm');
              }

              $('#page-how-to-arm div.countdown').fadeOut(function(){
                  $('#page-how-to-arm div.progress-bar').css('width', '100%')
                   .removeClass('progress-bar-danger').addClass('progress-bar-success');
              });
              $('#page-how-to-arm input.passcode').val('');
              $.mobile.loading('hide');
              socket.emit('app update', 'status', {
                  alarm_status: armType
              });

              setTimeout(function(){
                  history.back();
              }, 500);
          }
      } // armCountdown

      function cancelCountdown (isBackBtn) {
          _cancelArm = true;

          $('#page-how-to-arm input.passcode').val('');

          if (!_countDown) {
              return;
          }
          _countDown = false;

          $('#page-how-to-arm div.countdown').fadeOut(function(){
              $('#page-how-to-arm div.progress-bar').css('width', '100%')
               .removeClass('progress-bar-warning progress-bar-danger').addClass('progress-bar-success');
          });
          $.mobile.loading('hide');

          setTimeout(function(){
              $.mobile.loading('show', {
                  text: 'Arm Process Cancelled',
                  textVisible: true,
                  textonly: true,
                  theme: 'b'
              });
          }, 500);

          setTimeout(function(){
              $.mobile.loading('hide');
              if (!isBackBtn) {
                  history.back();
              }
          }, 1500);
      } // cancelCountdown

      function resizeImage (canvas) {
          var url     = canvas.attr('data-url');
          var context = canvas.getContext('2d');
          var imgObj  = new Image();

          imgObj.onload = function() {
              context.drawImage(imgObj, 0, 0, 120, 80);
          };
          imgObj.src = url;
      } // resizeImage


      var socket = io.connect('http://cheah.homeip.net:8080', {
          'max reconnection attempts': 100
      });

      socket.on('connect', function(){
          $('.connection').removeClass('text-danger text-default').addClass('text-success').html('Connected');
      });
      socket.on('connecting', function(){
          $('.connection').removeClass('text-danger text-success').addClass('text-default').html('Connecting..');
      });
      socket.on('disconnect', function(){
          $('#page-security div.armBtnWrap').hide();
          $('.troubles').removeClass('text-success text-default').addClass('text-warning').html('Unavailable');
          $('.status').removeClass('text-success text-default').addClass('text-warning').html('Unavailable');
          $('.connection').removeClass('text-success text-default').addClass('text-danger').html('Disconnected');
          notification('Server Offline', 'Server is currently detected offline, this may due to scheduled maintenance.', 10000);
      });
      socket.on('reconnect', function(){
          notification('Server Online', 'Server is detected back to online now, this may due to maintenance completed.', 10000);
      });
      socket.on('InitialUpdates', function(data){
           if (typeof data.info != 'undefined') {
               _data = data;

               $('.status').removeClass('text-danger text-default').addClass('text-success').html(data.info.name+' connected')
               $('#page-security div.armBtnWrap').show();
               updateTroubles();
               updateAlarmStatus(false);
               updateZones();
               updateSystemStatus();
           }
      });
      socket.on('Offline', function(data){
          $('#page-security div.armBtnWrap').hide();
          $('.troubles').removeClass('text-success text-default').addClass('text-danger').html('N/A');
          $('.status').removeClass('text-success text-default').addClass('text-danger').html('Disconnected');
          notification('Panel Offline', 'Your panel is detected offline now, this may due to internet connection problem.', 10000);
      });
      socket.on('DeviceUpdate', function(d){
          if (d.type == 'info') {
              _data.info[d.id] = d.value;
          } else if (d.type == 'status') {
              _data.status[d.id] = d.value;

              if (d.id == 'alarm_status') {
                  updateAlarmStatus(true);
              } else {
                  updateTroubles(d.id);
              }
          } else if (d.type == 'zone' || d.type == 'zones') {
              _data.zones[d.id] = d.value;
              updateZone(d.id, d.value);
          }
      });

      $('#home').on('pagecreate', function(){
          if (typeof window.webkitNotifications != 'undefined' && window.webkitNotifications.checkPermission()) {
              $('div.gainPermissions').show();
              $('div.gainPermissions').click(function(){
                  window.webkitNotifications.requestPermission();
                  permissionCheck();
              });
          } else { // either browser not support Notification or it already gained permission
              $('div.gainPermissions').remove();
          }
      });
      $('#page-security').on('pagecreate', function(){
          $(this).attr('data-render', '1');
          $('#page-security a.armBtn').click(function(){
              var sts = _data.status.alarm_status;

              if (sts == 'r') {
                  var opened = false;
                  $.each(_data.zones, function(k, v){
                      if (v == 'o' || v == 'b') {
                          if (v == 'o') {
                              opened = true;
                          }
                          setTimeout(function(){
                              $('#page-security ul[data-role=listview] li.'+k+' div.bypass').show();
                          }, 1000);
                      } else {
                          $('#page-security ul[data-role=listview] li.'+k+' div.bypass').hide();
                      }
                  });
                  if (opened) {
                      $.mobile.changePage('#dialog-alert-opened-zones', {
                          role: 'dialog'
                      });
                      $('#dialog-alert-opened-zones').dialog('option', 'closeBtn', 'none');
                      $('#dialog-alert-opened-zones').dialog('option', 'overlayTheme', 'a');
                  } else {
                      $.mobile.changePage('#page-how-to-arm');
                  }
              } else {
                  $.mobile.changePage('#page-how-to-arm');
              }
          });
      });
      $('#page-security').on('pagehide', function(){
          $('#page-security ul[data-role=listview] div.bypass').hide();
      });
      $('#page-how-to-arm').on('pagecreate', function(){
          $('#page-how-to-arm .cancelArm').click(function(){
              var isBackBtn = $(this).hasClass('back');
              cancelCountdown(isBackBtn);
          });
          $('#page-how-to-arm a.armType').click(function(){
              $('#page-how-to-arm a.armType').removeClass('ui-btn-active');
              $(this).addClass('ui-btn-active');
              $('#page-how-to-arm #code1').focus();
          });
      });
      $('#page-how-to-arm').on('pageshow', function(){
          var sts = _data.status.alarm_status;
          if (sts == 'a' || sts == 'h') {
              $('#page-how-to-arm h3.header').html('Confirm Disarmed');
              $('#page-how-to-arm h4.armCodeTxt').html('Enter Keypad Code To Disarmed');
              $('#page-how-to-arm div.armTypeWrap').hide();
          } else {
              $('#page-how-to-arm h3.header').html('Confirm Arm');
              $('#page-how-to-arm h4.armCodeTxt').html('Enter Keypad Code To Arm');
              $('#page-how-to-arm div.armTypeWrap').show();
          }
          $('#page-how-to-arm #code1').focus();
      }).on('pagehide', function(){
          $('#page-how-to-arm input.passcode').val('');
          $('#page-how-to-arm div.countdown').hide();
      });
      $('#page-cameras').on('pageshow', function(){
          $.each($('#page-cameras canvas.ipcam'), function(){
              resizeImage($(this));
          });
      });


      $('#page-how-to-arm input.passcode').click(function(){
          $(this).val('');
      }).keyup(function(){
          var n = $(this).attr('data-no');
          var i = parseInt(n) + 1;
          if (i > 4) {
              var sts = _data.status.alarm_status;

              if (sts == 'a' || sts == 'h') {
                  socket.emit('app update', 'status', {
                      alarm_status: 'r'
                  });
                
                  // TODO(callback): wait callback to confirm disarmed
                  $.mobile.loading('show', {
                      text: 'Disarmed successfully',
                      textVisible: true,
                      textonly: true,
                      theme: 'b'
                  });
                  setTimeout(function(){
                      $.mobile.loading('hide');
                      history.back();
                  }, 1000);
              } else {
                  // check zone status

                  armCountdown(10);
                  $(this).blur();
                  $.mobile.loading('show', {
                      text: 'Arm in 10 seconds...',
                      textVisible: true,
                      theme: 'a'
                  });
                  $('#page-how-to-arm div.countdown').fadeIn();
              }
          } else {
              $('#page-how-to-arm #code'+i).val('').focus();
          }
      });
    </script>
</body>
</html>
